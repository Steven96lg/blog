---
import Footer from '../components/Footer.astro';
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/png" href="/blog/logo.png" />
		<meta name="generator" content={Astro.generator} />
		<title>SLBlog</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Archivo+Narrow:ital,wght@0,400..700;1,400..700&family=Assistant:wght@200..800&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	</head>
	<body>
		<slot />
		<Footer />
	</body>
</html>

<script>
	const visited = JSON.parse(localStorage.getItem('visited') || '{}');
	const pathname = window.location.pathname;
	const today = new Date().toISOString().split('T')[0];

	if(!visited[pathname] || visited[pathname] !== today) {
		try {
			const response = await fetch('http://localhost:8000/visit', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ visits: pathname })
			});
			if (!response.ok) {
				throw new Error('Network response was not ok');
			}
			const data = await response.json();
			alert(data.message);
		} catch (error) {
			console.error('Error fetching views:', error);
		}
	}

	try{
		const response = await fetch('http://localhost:8000/get-visits');
		if (!response.ok) {
			throw new Error('Network response was not ok');
		}
		const data = await response.json();
		document.querySelector('.views span').textContent = data.visits['/']
		if(pathname !== '/'){
			document.querySelector('.views-only-post span').textContent = data.visits[pathname] || 0;
		}
	}catch (error) {
		console.error('Error fetching views:', error);
	}
	 visited[pathname] = today;
 	 localStorage.setItem("visited", JSON.stringify(visited));
</script>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
		background-color: #f9f9f9;
		background-color: #0e1115;
	}
</style>
